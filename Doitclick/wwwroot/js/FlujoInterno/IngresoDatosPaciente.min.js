function restaCantidad(){let i=$(this),t=i.closest("tr"),n=JSON.parse($(t).data("opts"));n.cantidad>1&&(n.cantidad--,$.each(_servicios_detalle_cotizacion,function(t,i){i.id==n.id&&(_servicios_detalle_cotizacion.splice(t,1),_servicios_detalle_cotizacion.push(n))}),$(t).data("opts",JSON.stringify(n)),$(t).find(".showcan").text(n.cantidad),$(t).find(".showtot").text("$"+parseInt(n.cantidad*n.valor).toMoney()),$(document).trigger("doitclick.events.onCambiaValor",{opts:n,type:"resta"}))}function sumaCantidad(){let i=$(this),t=i.closest("tr"),n=JSON.parse($(t).data("opts"));n.cantidad++;$.each(_servicios_detalle_cotizacion,function(t,i){i.id==n.id&&(_servicios_detalle_cotizacion.splice(t,1),_servicios_detalle_cotizacion.push(n))});$(t).data("opts",JSON.stringify(n));$(t).find(".showcan").text(n.cantidad);$(t).find(".showtot").text("$"+(n.cantidad*n.valor).toMoney());$(document).trigger("doitclick.events.onCambiaValor",{opts:n,type:"suma"})}function previsualizarImagen(){var n=document.querySelector("#img-previsualiza"),i=document.querySelector("input[type=file]").files[0],t=new FileReader;t.onloadend=function(){n.src=t.result;$(n).css("display","block")};i?t.readAsDataURL(i):n.src=""}window._servicios_detalle_cotizacion=[];$(function(){$(document).on("doitclick.events.onCambiaValor",function(){var n=0;$.each(_servicios_detalle_cotizacion,function(t,i){n+=i.cantidad*i.valor});$(".showapagar").text("$"+n.toMoney())});$(".agrgar-trabajo").on("click",function(){var n,i,u,r,f;if($("#demo-cs-multiselect option:selected").val()!=""){if($("#demo-cs-multiselect option:selected").val()=="Otro"){const t={id:"Otro",texto:"Evaluación Otras Prestaciones",descripcion:$("#DescripcionEvaluacionOP").val(),valor:0,cantidad:1};n=$("<tr>").data("opts",JSON.stringify(t));i=$("<td>");i.append($("<strong>").text(t.texto)).append($("<small>").text(t.descripcion));n.append(i);u=$("<td>").addClass("text-center").text("Por Evaluar");n.append(u);r=$("<td>").addClass("text-center").text(1);n.append(r);f=$("<td>").addClass("text-right").text("Por Evaluar");n.append(f);_servicios_detalle_cotizacion.push(t);$("#detalles-cotizacion").append(n);$("#btn-confirmar").text("Enviar a evaluación");$(".mensaje-otros").show("slow");return}const t={id:$("#demo-cs-multiselect option:selected").val(),texto:$("#demo-cs-multiselect option:selected").text(),descripcion:$("#demo-cs-multiselect option:selected").data("descripcion"),valor:$("#demo-cs-multiselect option:selected").data("valor"),cantidad:1};_servicios_detalle_cotizacion.push(t);n=$("<tr>").data("opts",JSON.stringify(t));i=$("<td>");i.append($("<strong>").text(t.texto)).append($("<small>").text(t.descripcion));n.append(i);u=$("<td>").addClass("text-center").text("$"+t.valor.toMoney());n.append(u);r=$("<td>").addClass("text-center");r.append($("<button>").prop({type:"button"}).addClass("btn btn-xs btn-primary").text("<").on("click",restaCantidad)).append($("<span>").addClass("pad-hor showcan").text(t.cantidad)).append($("<button>").prop({type:"button"}).addClass("btn btn-xs btn-primary").text(">").on("click",sumaCantidad));n.append(r);f=$("<td>").addClass("text-right showtot").text("$"+t.valor.toMoney());n.append(f);$("#detalles-cotizacion").append(n);$(document).trigger("doitclick.events.onCambiaValor",{opts:t,type:"nuevo"})}});$("#demo-cs-multiselect").on("change",function(){$(this).val()=="Otro"?$(".extension-otros").show("slow"):$(".extension-otros").hide("slow")});$("#frm-ingreso-datos-paciente").on("submit",function(){const t=$("#btn-confirmar").text();$("#btn-confirmar").prop("enabled",!1).text("...Cargando");let n=$(this).serializeFormJSON();return n.SrcImagen=$("#img-previsualiza").prop("src"),n.Servicios=_servicios_detalle_cotizacion,$.ajax({type:"POST",url:"/api/flujo-interno/ingreso-datos-paciente",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){console.log(n);const t=(new Date).toString()+" Charly";connection.invoke("SendMessage","Chachacharles",t).catch(n=>console.error(n.toString()))}).fail(function(n){console.log(n)}).always(function(){$("#btn-confirmar").prop("enabled",!0).text(t);connection.invoke("SendMessage","Chachacharles","Siempre paso por aqui").catch(n=>console.error(n.toString()))}),!1})});const connection=(new signalR.HubConnectionBuilder).withUrl("/hubs/push").build();connection.on("ReceiveMessage",(n,t)=>{const i=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=n+" says "+i;console.log("ReceiveMessage",r)});connection.start().catch(n=>console.error(n.toString()));